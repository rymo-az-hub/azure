# Day 1 Progress (2026-01-31)

## Goal (6 months)
Azure特化企業（MSパートナー含む）向けに、Platform / Landing Zone / IaC / 運用設計寄りの実績を個人環境で作る。

## Summary (What was achieved today)
- GitHubリポジトリに、設計ドキュメントとIaC（Bicep）の土台を作成
- Azure Policy（タグ必須・リージョン制限・RGタグ必須）をサブスクリプションスコープで適用
- 「ガードレールが効いている」証跡（Deny）を VNet / Resource Group の2系統で取得し、docs に記録

---

## Timeline (What I did, including failures)

### 0. Planning / Setup
- 目的を「Platform/LZ/IaC/運用設計寄りの成果物をGitHubに残す」に設定
- 個人環境の制約を前提に、まずは subscription scope で実装する方針

### 1. GitHub repo creation
- GitHubに新規リポジトリを作成（rymo-az-hub/azure）

### 2. Local git setup (failure -> fix)
- git が未インストールで `git clone` が失敗
  - エラー: `git : 用語 'git' は...認識されません`
- Git for Windows を導入し、git コマンドが利用可能に

### 3. Clone and repository structure
- `git clone` を実施してローカルに取得
- ディレクトリ構成を作成
  - docs/01-architecture
  - docs/02-governance
  - docs/03-operations
  - docs/04-adr
  - infra/platform
  - infra/workloads

### 4. Git commit identity (failure -> fix)
- `git commit` で Author identity 未設定のエラー
  - エラー: `Author identity unknown`
- git の user.name / user.email を設定して解消

### 5. GitHub authentication for push (failure -> fix)
- `git push` 時に認証が止まる
- VS Code の「Connect to GitHub」導線で認証を完了し push 成功
- GitHub上で docs / infra が見えることを確認

### 6. Docs: Policy baseline draft
- `docs/02-governance/policy-baseline.md` を作成
- ガードレールの目的、適用範囲、例外運用、初期ポリシーセットの方針を整理
- Evidence（証跡）も残す方針にした

### 7. Azure CLI login (failure -> fix)
- Azure CLI 実行時に `Please run 'az login'` が出る
- `az login` を実施して解消

### 8. Management Group access issue (failure -> design change)
- 管理グループ参照で権限不足
  - エラー: `AuthorizationFailed (Microsoft.Management/managementGroups/read)`
- 設計を変更: 個人環境では MG を諦め、subscription scope で代替

### 9. IaC (Bicep): Policy assignments v1
- `infra/platform/policy-assignments.bicep` を作成
  - Allowed locations（Japan East/West）
  - Require a tag on resources（Owner/CostCenter/Environment）
- built-in policy definition ID は、CLI から取得してパラメータで渡す方式

### 10. Deployment troubleshooting (failure -> fix)
- `az deployment sub create` の待ち時間・デプロイ名で混乱
- `DeploymentNotFound` が出るケースあり
- `az deployment sub list/show/operation list` で状況を確認し、正しいデプロイを実行できる状態に整理

### 11. Policy definition lookup (failure -> fix)
- `az policy definition show --id ...` が使えず詰まる
- 回避: `az policy definition list` から displayName で ID を取得し、必要に応じて `--name <GUID>` で parameters を確認
- Allowed locations のパラメータが `listOfAllowedLocations` であることを確認

### 12. what-if -> create -> verification
- `az deployment sub what-if` で作成対象を確認
- `az deployment sub create` で適用
- `az policy assignment list` で `pa-...` が作成されたことを確認

### 13. Evidence 1: Deny (resource without required tags)
- タグ無しでVNetを作成しようとして Deny を確認
  - `RequestDisallowedByPolicy`
  - `pa-require-tag-*` が原因として表示されることを確認

### 14. Add RG tag policy (gap found -> implemented)
- 「Require a tag on resources」がRGには効かないギャップを認識
- built-in の `Require a tag on resource groups` を追加する方針
- table表示で id が出ず混乱したが、`-o tsv` で id を取得して解決
  - `/providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-2d3abc0a5025`
- BicepにRG用の割当を追加（Owner/CostCenter/Environment）

### 15. Evidence 2: Deny (RG without required tags)
- タグ無しRG作成が Deny されることを確認
  - `RequestDisallowedByPolicy`
  - `pa-require-rg-tag-*` が3本並び、効果が deny であることも確認

### 16. Markdown display issues (failure -> fix)
- docs 追記で「切れて見える」問題が発生
- 原因: コードフェンスの閉じ忘れ / 表示崩れ / PowerShellの `>>` 継続入力
- 対応: フェンスを避け、インデントコード＋見出し＋箇条書きで統一し、崩れない形式に修正

### 17. Commit & push (finalize)
- `policy-baseline.md` を更新してコミット
- `git show --stat` で変更量を確認
- `origin/main` に push 済みであることを確認

---

## Artifacts (what exists in the repo)
- docs/02-governance/policy-baseline.md
  - ガードレール方針 + Evidence（Deny証跡: VNet / RG）
- infra/platform/policy-assignments.bicep
  - Allowed locations / Required tags (resources) / Required tags (resource groups)

## Next (planned)
- Storage Secure Transfer Required をIaCで追加し、Deny/準拠の証跡を残す
- Policy Set (Initiative) 化して、ベースライン一括適用に昇格
